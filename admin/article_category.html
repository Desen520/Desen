<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>文章列表</title>
    <link rel="stylesheet" href="./libs/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/iconfont.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script src="./libs/jquery-1.12.4.min.js"></script>
    <script src="./libs/bootstrap/js/bootstrap.min.js"></script>
    <!-- 引入模板引擎js文件 -->
    <script src="./libs/template-web.js"></script>
  </head>

  <body>
    <div class="container-fluid">
      <div class="common_title">
        文章类别管理
      </div>
      <div class="container-fluid common_con">
        <table
          class="table table-striped table-bordered table-hover mp20 category_table"
        >
          <thead>
            <tr>
              <th>名称</th>
              <th>Slug</th>
              <th class="text-center" width="100">操作</th>
            </tr>
          </thead>
          <tbody>
            <!-- <tr>
              <td>奇趣事</td>
              <td>funny</td>
              <td class="text-center">
                <a
                  href="javascript:void(0)"
                  data-toggle="modal"
                  class=" btn btn-info btn-xs"
                  >编辑</a
                >
                <a href="javascript:void(0)" class="btn btn-danger btn-xs"
                  >删除</a
                >
              </td>
            </tr> -->
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3" class="text-center">
                <a
                  href="javascript:void(0)"
                  class="btn btn-success"
                  id="xinzengfenlei"
                  data-toggle="modal"
                  data-target="#exampleModal"
                  >新增分类</a
                >
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    <!-- bootstrap中的模态框 -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="exampleModalLabel">文章类别管理</h4>
          </div>
          <div class="modal-body">
            <form>
              <input type="hidden" name="" id="categoryId" />
              <div class="form-group">
                <label for="recipient-name" class="control-label"
                  >文章分类名称</label
                >
                <input type="text" class="form-control" id="recipient-name" />
              </div>
              <div class="form-group">
                <label for="message-text" class="control-label"
                  >文章分类介绍:</label
                >
                <textarea class="form-control" id="message-text"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              data-dismiss="modal"
              id="btn-qux"
            >
              取消
            </button>
            <button type="button" class="btn btn-primary" id="queren">
              确认
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="./js/http.js"></script>
    <script type="text/html" id="list">
          {{each data }}
          <tr>
              <td>{{$value.name}}</td>
              <td>{{$value.slug}}</td>
              <td class="text-center">
                  <a href="javascript:void(0)" data-id='{{$value.id}}' data-toggle="modal" class="btn btn-info btn-xs" data-target="#exampleModal">编辑</a>
                  <a href="javascript:void(0)" data-id='{{$value.id}}' class="btn btn-danger btn-xs btn-delete">删除</a>
              </td>
          </tr>
      {{/each}}
    </script>
    <script>
      // 入口函数
      $(function() {
        getData();
        // 封装函数 方便调用
        function getData() {
          $.get({
            url: BigNew.category_list,
            success: function(res) {
              // console.log(res);
              $("tbody").html(template("list", res));
            }
          });
        }
        //当点击某个按钮的时候显示模态框，会触发一个事件show.bs.modal 一般用在两个按钮用同一个模态框
        $("#exampleModal").on("show.bs.modal", function(e) {
          //   console.log(e.relatedTarget);
          //   通过relatedTarget 属性访问点击时那个按钮
          if (e.relatedTarget == $("#xinzengfenlei")[0]) {
            $("#exampleModalLabel").text("文章新增");
            $("#queren").text("新增");
          } else {
            $("#exampleModalLabel").text("文章编辑");
            $("#queren").text("确认编辑");
            // 获取点击按钮的id 此时点击的时编辑按钮 所以时获取编辑按钮的id
            var cateId = $(e.relatedTarget).attr("data-id");
            $.get({
              url: BigNew.category_search,
              data: {
                id: cateId
              },
              success: function(res) {
                // console.log(res);
                $("#categoryId").val(res.data[0].id);
                $("#recipient-name").val(res.data[0].name);
                $("#message-text").val(res.data[0].slug);
              }
            });
          }
        });
        // 模态框取消按钮注册点击事件，点击的时候，将表单中的数据全部清空
        $("#btn-qux").on("click", function() {
          $(".modal-body form")[0].reset();
        });
        // 给新增/编辑 的确认按钮添加点击事件
        $("#queren").on("click", function() {
          var mingzi = $(this).text();
          //   console.log(name);
          if (mingzi == "新增") {
            // alert("新增");
            //1.先获取到表单中的信息
            var name = $("#recipient-name").val();
            // console.log(name);
            var slug = $("#message-text").val();
            // console.log(slug);
            // //2.发送ajax请求，将新增的数据添加后台数据库中
            $.post({
              url: BigNew.category_add,
              data: {
                name: name,
                slug: slug
              },
              success: function(res) {
                $("#exampleModal").modal("hide");
                getData();

                // console.log(res);
              }
            });
          } else {
            var name = $("#recipient-name").val();
            var id = $("#categoryId").val();
            var slug = $("#message-text").val();
            $.post({
              url: BigNew.category_edit,
              data: {
                id: id,
                name: name,
                slug: slug
              },
              success: function(res) {
                // console.log(res);
                $("#exampleModal").modal("hide");
                getData();
              }
            });
          }
        });
        // 给删除添加点击事件
        $("tbody").on("click", ".btn-delete", function() {
          var ans = confirm("你真的要删除吗");
          var daleId = $(this).attr("data-id");
          if (ans) {
            $.post({
              url: BigNew.category_delete,
              data: {
                id: daleId
              },
              success: function(res) {
                $("#exampleModal").modal("hide");
                getData();
              }
            });
          }
        });
      });
    </script>
  </body>
</html>
